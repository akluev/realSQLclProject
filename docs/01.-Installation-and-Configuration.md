- [1. Software Requirements](#1-software-requirements)
- [2. Configuration](#2-configuration)
  - [2.1. VM Database](#21-vm-database)
    - [2.1.1. Download and Install VM 23ai Free Database VM](#211-download-and-install-vm-23ai-free-database-vm)
    - [2.1.2. Make Sure Bidirectional Clipboard Sharing is Running](#212-make-sure-bidirectional-clipboard-sharing-is-running)
    - [2.1.3. Make APEX and ORDS on VM Accessible from your Host](#213-make-apex-and-ords-on-vm-accessible-from-your-host)
    - [2.1.4. Make the Oracle Database on the VM Accessible via SQL\*Net](#214-make-the-oracle-database-on-the-vm-accessible-via-sqlnet)
    - [2.1.5. Configure Archivelog and Flashback Database](#215-configure-archivelog-and-flashback-database)
    - [2.1.6. Create a Deployer User](#216-create-a-deployer-user)
    - [2.1.7. Cleanup Flashback Recovery Area](#217-cleanup-flashback-recovery-area)
  - [2.2. Setup SQLcl Connections](#22-setup-sqlcl-connections)
    - [2.2.1. Setup Developer Connections to CLA Databases](#221-setup-developer-connections-to-cla-databases)
    - [2.2.2. Setup DBA Connections to CLA Databases](#222-setup-dba-connections-to-cla-databases)
    - [2.2.3. Setup Connections to the VM Database](#223-setup-connections-to-the-vm-database)


# 1. Software Requirements

- SQLcl : Oracle SQLDeveloper Command-Line (SQLcl) version: 25.3.0.0 ( and JDK 17)

- Oracle VM <a href="https://www.oracle.com/ca-en/virtualization/technologies/vm/downloads/virtualbox-downloads.html" class="external-link" data-card-appearance="inline" rel="nofollow">https://www.oracle.com/ca-en/virtualization/technologies/vm/downloads/virtualbox-downloads.html</a>

- VS Code

- Git
  - Git Bash ( or any Bash ) in PATH 
    The scrips provided in this repo expect that `bash -c echo "Hi"` command works.
  - On Mac it means running `brew bash`
  - On Windows it means adding path to bash.exe, usually ""C:\Program Files\Git\bin\" into PATH

- Remote Git Repository, for example [https://github.com/akluev/realSQLclProject](https://github.com/akluev/realSQLclProject)

# 2. Configuration

## 2.1. VM Database

### 2.1.1. Download and Install VM 23ai Free Database VM

<a href="https://www.oracle.com/ca-en/virtualization/technologies/vm/downloads/virtualbox-downloads.html" class="external-link" rel="nofollow">Oracle VM VirtualBox - Downloads | Oracle Technology Network | Oracle Canada</a>

### 2.1.2. Make Sure Bidirectional Clipboard Sharing is Running

You will need to copy/paste a lot to/from clipboard. So, if sharing is not running, from the VirtualBox window menu (while VM is running):

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="09ee0dbb-2bef-4676-99df-5e7ea8743cae" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
Devices → Insert Guest Additions CD Image…
```

</div>

</div>

This mounts `/run/media/oracle/VBox_GAs_*/`.

After install run

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="9e745871-66d3-4886-9049-a6e7e3f3837a" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
sudo reboot
```

</div>

</div>

### 2.1.3. Make APEX and ORDS on VM Accessible from your Host

During installation, attach VM Network Adapter to NAT and verify default port forwarding:

<span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img src="images/image-20251027-232806.png" class="confluence-embedded-image image-center" loading="lazy" data-image-src="images/image-20251027-232806.png" data-height="799" data-width="964" data-unresolved-comment-count="0" data-linked-resource-id="2538536966" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-20251027-232806.png" data-base-url="https://example.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="2538504193" data-linked-resource-container-version="1" data-media-id="b62bcccb-1493-4414-9b3a-eab71928a373" data-media-type="file" srcset="images/image-20251027-232806.png 2x, images/image-20251027-232806.png 1x" width="760" alt="image-20251027-232806.png" /></span>

URLs to APEX and ORDS should work right away after the installation.

Try <a href="http://localhost:8080/ords/_/landing" class="external-link" rel="nofollow">http://localhost:8080/ords/_/landing</a> - it should work

### 2.1.4. Make the Oracle Database on the VM Accessible via SQL\*Net

On the VM:

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="bc70e2ba-6f76-4c63-b75b-af158050712e" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
lsnrctl stop
vi $ORACLE_HOME/network/admin/listener.ora
```

</div>

</div>

Set HOST=0.0.0.0 i.e. allow to lsiten on all interfaces. By default it’s set to 127.0.0.1 which listens only on VM Internal NIC

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="58e66d6d-440f-446e-b6e6-716c67ac973a" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
DEFAULT_SERVICE_LISTENER = FREE

LISTENER =
  (DESCRIPTION_LIST =
    (DESCRIPTION =
      (ADDRESS = (PROTOCOL = TCP)(HOST = 0.0.0.0)(PORT = 1521))
      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))
    )
  )


SID_LIST_LISTENER =
 (SID_LIST =
 (SID_DESC =
 (GLOBAL_DBNAME = free)
 (SID_NAME = free)
 (ORACLE_HOME = /opt/oracle/product/23ai/dbhomeFree )
 )
 )
```

</div>

</div>

Restart Listener and check if it listens on all NICs

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="9e1e9223-16e9-46fb-9f87-29c5a6f5c834" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
lsnrctl start
netstat -an |grep 1521|grep LIST

# expected:
[oracle@vbox ~]$ netstat -an |grep 1521|grep LIST
tcp        0      0 0.0.0.0:1521            0.0.0.0:*               LISTEN     
```

</div>

</div>

Connect to the database from SQL Developer, SQLcl on your workstation. Passwords for all accounts is **oracle**

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="d8ba8aa1-2605-4fe9-ae9f-70800bb2c113" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
# PDB 

SQL>  conn sys/oracle@//localhost:1521/freepdb1 as sysdba
Connected.

# CDB
SQL>  conn sys/oracle@//localhost:1521/free as sysdba
Connected.
SQL>
```

</div>

</div>

### 2.1.5. Configure Archivelog and Flashback Database

From VM console try to login with / as sysdba. Most likely you will get an ORA-01017 error:

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="fb0d6059-e186-422c-b2aa-4bcb03ecc3dd" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
[oracle@vbox mnt]$ sqlplus / as sysdba

SQL*Plus: Release 23.0.0.0.0 - Production on Mon Oct 27 23:52:16 2025
Version 23.9.0.25.07

Copyright (c) 1982, 2025, Oracle.  All rights reserved.

ERROR:
ORA-01017: invalid credential or not authorized; logon denied
Help: https://docs.oracle.com/error-help/db/ora-01017/

```

</div>

</div>

Verify that `TWO_TASK` varaible is set and unset it and ORACLE_SID is in uppercase. Now you should be able to connect. Shutdown and Restart the Database to make sure you can proceed to the next step :

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="ed693dc8-de6f-41c6-b60b-2033edfd8feb" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
 unset TWO_TASK
 export ORACLE_SID=FREE
 sqlplus / as sysdba

 [oracle@vbox mnt]$ sqlplus / as sysdba

SQL*Plus: Release 23.0.0.0.0 - Production on Tue Oct 28 00:02:49 2025
Version 23.9.0.25.07

Copyright (c) 1982, 2025, Oracle.  All rights reserved.


Connected to:
Oracle Database 23ai Free Release 23.0.0.0.0 - Develop, Learn, and Run for Free
Version 23.9.0.25.07

SQL> shutdown immediate
Database closed.
Database dismounted.
ORACLE instance shut down.
SQL> startup
ORACLE instance started.

Total System Global Area 1603293992 bytes
Fixed Size          4928296 bytes
Variable Size         838860800 bytes
Database Buffers      754974720 bytes
Redo Buffers            4530176 bytes
Database mounted.
Database opened.
SQL> 
```

</div>

</div>

Now we can configure archivelog mode and flashback database. First, we need to create a folder for the FRA:

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="0d775189-8499-4f31-bd2a-75ed25356c4e" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
mkdir -p /opt/oracle/oradata/fast_recovery_area
```

</div>

</div>

Login to SQLPlus ( or SQLcl) on the VM to configure the database:

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="9b86b16a-b16d-4258-9e9b-1b5e9cd0cfa4" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
 sqlplus / as sysdba

SHUTDOWN IMMEDIATE;
STARTUP MOUNT;
ALTER SYSTEM SET db_recovery_file_dest_size = 50G SCOPE=BOTH;
ALTER SYSTEM SET db_recovery_file_dest = '/opt/oracle/oradata/fast_recovery_area' SCOPE=BOTH;
ALTER DATABASE ARCHIVELOG;
ALTER DATABASE FLASHBACK ON;
ALTER DATABASE OPEN;
```

</div>

</div>

Verify:

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="f269d5e3-b596-43ec-a4d1-d772712dd6cc" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
SQL> SELECT flashback_on FROM v$database; 

FLASHBACK_ON
------------------
YES

SQL> SELECT * FROM v$recovery_file_dest;      

NAME
--------------------------------------------------------------------------------
SPACE_LIMIT SPACE_USED SPACE_RECLAIMABLE NUMBER_OF_FILES     CON_ID
----------- ---------- ----------------- --------------- ----------
/opt/oracle/oradata/fast_recovery_area
 5.3687E+10  671319552             0           5      0
```

</div>

</div>

Test:

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="f5279bd8-b53b-489c-8f86-1d4f782c06b9" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
conn sys/oracle@//localhost:1521/freepdb1 as sysdba

CREATE RESTORE POINT test;

--- Do something 
create table t1 as select * from dba_objects;
select count(*) from t1;

ALTER PLUGGABLE DATABASE FREEPDB1  CLOSE IMMEDIATE;
FLASHBACK PLUGGABLE DATABASE FREEPDB1 TO RESTORE POINT TEST;
ALTER PLUGGABLE DATABASE FREEPDB1  OPEN RESETLOGS;

---Repeat and get an error:
select count(*) from t1;

DROP RESTORE POINT test;
```

</div>

</div>

Expected Output:

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="0c599bbe-5efd-4629-acdd-ceca403fa410" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
SQL> conn sys/oracle@//localhost:1521/freepdb1 as sysdba
Connected.
SQL> CREATE RESTORE POINT test;

RESTORE POINT TEST created.

SQL> create table t1 as select * from dba_objects;

Table T1 created.

SQL> select count(*) from t1;

COUNT(*) 
________
   80483

1 row selected.

SQL> ALTER PLUGGABLE DATABASE FREEPDB1  CLOSE IMMEDIATE;

Pluggable database FREEPDB1 altered.


Flashback succeeded.

SQL> ALTER PLUGGABLE DATABASE FREEPDB1  OPEN RESETLOGS;

Pluggable database FREEPDB1 altered.

SQL> select count(*) from t1;

Error starting at line : 1 in command -
select count(*) from t1
Error at Command Line : 1 Column : 22
Error report -
SQL Error: ORA-00942: table or view "SYS"."T1" does not exist

SQL> DROP RESTORE POINT test;

RESTORE POINT TEST dropped.
```

</div>

</div>

### 2.1.6. Create a Deployer User

As SYS@FREEPDB1 run the following script ( The latest version is in the repo at `scripts/sql/create_cla_deployer.sql`

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="e307521b-7a98-466d-a539-40415fb56459" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
create user if not exists cla_DEPLOYER no authentication 
/

grant dba to cla_DEPLOYER
/

grant connect to cla_DEPLOYER
/

grant APEX_DEPLOYERISTRATOR_ROLE  to cla_DEPLOYER with admin option
/

grant execute on sys.dbms_crypto to cla_DEPLOYER with grant option;

grant execute on sys.dbms_session  to cla_DEPLOYER with grant option;

grant execute on sys.javascript to cla_DEPLOYER with grant option;
```

</div>

</div>

Alter user cla_DEPLOYER so that it can connect

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="53550a85-fd27-423e-88d4-0c0bdfcec95d" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
alter user cla_DEPLOYER identified by <your_password>
```

</div>

</div>

### 2.1.7. Cleanup Flashback Recovery Area

After certain period of work, the FRA may become full, and database operations may halt failing with errors like these:

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="69e2dde9-171a-4da5-8315-ca06ad76c55e" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
ORA-19809: limit exceeded for recovery files
ORA-19804: cannot reclaim xxx bytes disk space from xx bytes limit
```

</div>

</div>

To prevent it, you may periodically clean out obsolete files in the FRA. Connect to RMAN from VM console:

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="476ac0d6-77b6-4b8c-871e-52420da3f13b" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
unset TWO_TASK
export ORACLE_SID=FREE
rman target /
```

</div>

</div>

Only once set retention policy ( if it does not work, reduce recovery window):

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="c9914fd9-21a8-422d-8484-1b743a0fe58d" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
CONFIGURE RETENTION POLICY TO REDUNDANCY 1;
CONFIGURE RETENTION POLICY TO RECOVERY WINDOW OF 7 DAYS;
```

</div>

</div>

Periodically log in to RMAN to delete obsolete backups and archivedlogs:

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="c3241f81-4da9-4d93-a538-d6e12397cb1e" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
DELETE NOPROMPT OBSOLETE;
```

</div>

</div>

If you ( as the most people) did not do paeriodic maintanance, you can compeletely clean FRA when it gets cloged.

To comepelety cleanup FRA run the following RMAN script that moves the DB to NOARCHIVELOG, so all backups become obsolete and after that delete them and move the DB back to flashback and archivelog:

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="cdf416ba-e4fa-4405-b500-1bab69a21d13" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
ALTER DATABASE FLASHBACK OFF;
SHUTDOWN IMMEDIATE;
STARTUP MOUNT;
ALTER DATABASE NOARCHIVELOG;
ALTER DATABASE OPEN;

DELETE NOPROMPT OBSOLETE;
DELETE NOPROMPT ARCHIVELOG ALL;
delete noprompt backup; 

SHUTDOWN IMMEDIATE;
STARTUP MOUNT;
ALTER DATABASE ARCHIVELOG;
ALTER DATABASE FLASHBACK ON;
ALTER DATABASE OPEN;
```

</div>

</div>

Verify cleanup in the OS:

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="30fb4384-3879-4dbe-9f9c-2e2d72c2850d" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
du -sh /opt/oracle/oradata/fast_recovery_area/FREE/*
```

</div>

</div>

and in SQL:

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="717dc043-6dae-403d-b956-10d6878e299c" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
SELECT name, space_limit/1024/1024 AS mb_limit,
       space_used/1024/1024 AS mb_used,
       space_reclaimable/1024/1024 AS mb_reclaimable
FROM v$recovery_file_dest;
```

</div>

</div>

## 2.2. Setup SQLcl Connections

The rest of the documenation and many scripts in the repo will rely on these connection names.

### 2.2.1. Setup Developer Connections to CLA Databases

To set connections, developers will use the following script: `scripts/sql/deployment/create_developer_connections.sql` . Before running the script, set defines for your proxy user and its passwords:

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="1e2db675-e9f0-4dd7-9a42-6b30e272fffc" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
define PROXY_USER=AKLUEV
define PROXY_PASSWORD_DEV=****
define PROXY_PASSWORD_TEST=****
define PROXY_PASSWORD_PROD=****
@scripts/sql/deployment/create_developer_connections.sql
```

</div>

</div>

This script creates the following connections

<div class="table-wrap">

<table class="confluenceTable" data-table-width="1330" data-layout="center" data-local-id="a2443be2-21f8-40e6-a269-c6acaba815c7">
<tbody>
<tr>
<th class="confluenceTh"><p><strong>Name</strong></p></th>
<th class="confluenceTh"><p><strong>Env</strong></p></th>
<th class="confluenceTh"><p><strong>User</strong></p></th>
<th class="confluenceTh"><p><strong>Comment</strong></p></th>
</tr>
&#10;<tr>
<td class="confluenceTd"><p>proj_dev</p></td>
<td class="confluenceTd"><p>DEV</p></td>
<td class="confluenceTd"><p><code>&amp;PROXY_USER.[CLA_DEPLOYER]</code></p></td>
<td class="confluenceTd"><p>Export from Dev account</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>proj_dev</p></td>
<td class="confluenceTd"><p>TEST</p></td>
<td class="confluenceTd"><p><code>&amp;PROXY_USER.[CLA_DEPLOYER]</code></p></td>
<td class="confluenceTd"><p>DBA. Export/Deployment from/to Test</p></td>
</tr>
<tr>
<td class="confluenceTd"><p>prod_apex</p>
<p>prod_pub</p>
<p>prod_ut</p></td>
<td class="confluenceTd"><p>PROD</p></td>
<td class="confluenceTd"><p><code>&amp;PROXY_USER.[SCHEMA]</code></p></td>
<td class="confluenceTd"><p>Export from Prod accounts</p></td>
</tr>
</tbody>
</table>

</div>

### 2.2.2. Setup DBA Connections to CLA Databases

These connections should be set by the personnel responsible for Prod deployment. Similar to the section above, run the script `scripts/sql/deployment/create_dba_connections.sql` after providing define varaibles.

This script creates the following connections:

<div class="table-wrap">

|  |  |  |  |
|----|----|----|----|
| **Name** | **Env** | **User** | **Comment** |
| proj_dev | DEV | `&PROXY_USER.[CLA_DEPLOYER]` | Export from Dev account |
| proj_dev | TEST | `&PROXY_USER.[CLA_DEPLOYER]` | DBA. Export/Deployment from/to Test |
| proj_prod | PROD | `&PROXY_USER.[CLA_DEPLOYER]` | Deployment to Prod account |

</div>

### 2.2.3. Setup Connections to the VM Database

Setup these connections to VM database on each project member’s workstation. To set up these connections, run the following script `scripts/sql/deployment/create_vm_connections copy.sql`.

This script creates the following connections:

<div class="table-wrap">

|          |         |                  |                                    |
|----------|---------|------------------|------------------------------------|
| **Name** | **Env** | **User**         | **Comment**                        |
| proj_vm  | VM-PDB  | `[CLA_DEPLOYER]` | Export/Deployment from Dev account |
| vm_sys   | VM-PDB  | `SYS as SYSDBA`  | PDB DBA                            |
| vm-cdb   | VM-CDB  | `SYS as SYSDBA`  | CDB DBA                            |

</div>
