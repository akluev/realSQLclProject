Hot Fix is a type of update when Changes are made in production and need to flow in the opposite direction from production back to DEV and Test

- In a case of ANY hotfix, even the smallest and most obvious, you MUST perform steps 1-6 and 8 below to properly record the changes in Liquibase catalog and DB controller.

<!-- -->

- Steps 7, 9, and 10 may be performed “manually” by installing affected objects in DEV and TEST, however, for changeset consistency, it’s recommended always to follow these steps as well.

- [1. Make Required Changes in Prod](#1-make-required-changes-in-prod)
- [2. Check out the New Branch From Main](#2-check-out-the-new-branch-from-main)
- [3. Export from Prod](#3-export-from-prod)
- [4. Stage Changes](#4-stage-changes)
- [5. Run Against VM](#5-run-against-vm)
- [6. Sync Changesets in Prod](#6-sync-changesets-in-prod)
- [7. Baseline DEV](#7-baseline-dev)
- [8. Merge into Main](#8-merge-into-main)
- [9. Deploy to DEV](#9-deploy-to-dev)
- [10. Deploy to Test](#10-deploy-to-test)


# 1. Make Required Changes in Prod

In case of hotfix, make and test ( as much as possible) all required changes in Prod.

# 2. Check out the New Branch From Main

Start a new branch, exactly the same way as you would for Ongoing development.

# 3. Export from Prod

Connect to Prod and export all changed objects using `project export -o command` the same way as you would for Ongoing development.

For example, I have a hotfix for four APEX apps I need to backport now.

<div class="code panel pdl conf-macro output-block" hasbody="true" local-id="28cdca6b-df9f-4f81-a551-c86a54a2ffd8" macro-id="5703adf9-ec02-4c95-9cf0-8fca2ae6c842" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
SQL> proj export -o APEX.104,APEX.116,APEX.202,APEX.666
The current connection //10.194.2.167:1521/pdb01.privsubnet2reg.vcnclaylacy01.oraclevcn.com CLA_DEPLOYER will be used for all operations
*** APEX_APPLICATIONS ***
Exporting Workspace CLA_INTERNAL - application 104:MCL Manager
Exporting Workspace CLA_INTERNAL - application 666:Applicant Tracking
Exporting Workspace CLA_INTERNAL - application 202:In Flight Services
Exporting Workspace CLA_INTERNAL - application 116:Financial Planning and Analysis
-------------------------------
APEX_APPLICATION              4
-------------------------------
Exported 4 objects
Elapsed 29 sec
```

</div>

</div>

# 4. Stage Changes

- Commit changes to git to allow staging

- Connect to Prod and stage all exported changes using `project stage -o command` the same way as you would for Ongoing development.

- Commit changes to git, ideally push them to the remote, and get them approved ( if possible)

- As usual, don’t forget to discard fake ORDS changes

- <div class="code panel pdl conf-macro output-block" hasbody="true" local-id="3e348f59-c801-4db7-ba8e-a87b9b8b7d74" macro-id="c9b7bb78-97ad-4b68-bc11-cd78d8456679" macro-name="code" style="border-width: 1px;">

  <div class="codeContent panelContent pdl">

  ``` sql
  !git restore --source=main --worktree --staged -- dist/releases/ords

    
  ```

  </div>

  </div>

- If nessesry do other required stage-time chnages, for example `add-custom`

# 5. Run Against VM

As usual, before committing changes and making them permanent, run them against VM to make sure the chnageset runs

<div class="code panel pdl conf-macro output-block" hasbody="true" local-id="9d418075-48f6-44b4-ae5b-7033f14c2fc8" macro-id="10edd09e-4f36-4aa5-af0a-027dd1a33130" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
conn -name proj_vm
cd dist.
@install 
```

</div>

</div>

Run against VM until you get a clean deployment.

# 6. Sync Changesets in Prod

- Commit the staged changes

<div class="code panel pdl conf-macro output-block" hasbody="true" local-id="f0c42ffd-3040-4a4d-9ce4-a06cb3289d9b" macro-id="78786184-8895-4809-baed-1bf0b7c0573c" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
git add .
git commit -m 'hotfix-automations ready to mwerge'
```

</div>

</div>

- Mark new changesets as run in prod:

<div class="code panel pdl conf-macro output-block" hasbody="true" local-id="00246665-a836-4299-9f4f-b39ad8efb44e" macro-id="a2c6399e-447d-4ef3-aa21-6149a1bea66e" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
conn -name proj_prod
cd dist --- if needed , run `pwd` to cherc
lb changelog-sync -changelog-file releases/main.changelog.xml 
```

</div>

</div>

- If possible, verify that nothing is waiting for prod deployment:

<div class="code panel pdl conf-macro output-block" hasbody="true" local-id="606fb96f-f36e-474f-b10a-7457791db86a" macro-id="b4ee3699-18ef-4f35-a4f5-5355cc094fe3" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
lb status  -changelog-file releases/main.changelog.xml
```

</div>

</div>

> **<span colorid="qoumbob29n">Critical Note: </span>**If your hotfix includes APEX applications, that are designed as \```  runOnChange="true"` `` changesets, and **there is no way to exclude them from rerunning.** i.e. if you change app 116 as a part of your hotfix, **it still will rerun during next normal deployment.** This can only be prevented my manually excluding apps from a controller `dist/releases/apex/apex.changelog.xml` .

# 7. Baseline DEV

> **Note:** For small changes, you can replace this step by manually running scripts with chnages in DEV and TEST. However, it may introduce consistency problems later one. So, please use it with a lot of caution, and only for the smallest chnages and when you are sure that would be no merge conflicts!

For every hotfix, we need to “baseline” LB control tables in DEV to current main branch, to make sure we ONLY deploy prod changes and don’t kill any unexpedcted work-in-progress in DEV…

- Checkout the main branch in git

<div class="code panel pdl conf-macro output-block" hasbody="true" local-id="4e23b8de-7b43-4d92-b84f-0bf30446d80e" macro-id="7d80e0d6-6cc0-4b04-a770-d1e291f93dce" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
git switch main
```

</div>

</div>

- connect to dev in SQLcl

- drop all LB objects

<div class="code panel pdl conf-macro output-block" hasbody="true" local-id="cbc1acbf-5181-4808-9103-99c667dc8c96" macro-id="748c7294-5571-4ec3-a427-28d1b54849d1" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
lb drop-all
--Starting Liquibase at 2025-11-24T14:00:53.818350 using Java 17.0.13 (version 4.30.0 #0 built at 2025-04-01 10:24+0000)
INFO: The drop-all command may result in unrecoverable destructive changes to objects at 'jdbc:oracle:thin:@//10.194.2.158:1521/dev.privsubnet2reg.vcnclaylacy01.oraclevcn.com'.
To protect against unwanted drops, set --requireForce=true, which will require a --force=true flag on the command.
Learn more at https://docs.liquibase.com/dropall.

All objects dropped from CLA_DEPLOYER@jdbc:oracle:thin:@//10.194.2.158:1521/dev.privsubnet2reg.vcnclaylacy01.oraclevcn.com


Operation completed successfully.
```

</div>

</div>

- Sync up the Dev environment and the main branch

<div class="code panel pdl conf-macro output-block" hasbody="true" local-id="eb23704d-9d22-41f5-b84d-5045d724c10f" macro-id="394137fe-0574-43a7-a42c-f386a7476ea3" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
lb changelog-sync -changelog-file releases/main.changelog.xml
```

</div>

</div>

- At this point from LB perspective your DEV environment looks exactly as Prod before this hotfix.

> **DO NOT Deploy to DEV** at this point! Not yet; too early!

# 8. Merge into Main

- Make sure you are on the main branch by running `git status`

- Merge hotfix branch into main.

- **The right way to do it would be submitting, reviewing, and aproving PR**

- It can be done locally via the following command, but it’s a risk of lost updates:

<div class="code panel pdl conf-macro output-block" hasbody="true" local-id="aea65744-32ee-43fd-bf36-1e8be8e14d1b" macro-id="49faa703-1191-411d-abfd-128ddc3e4e96" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
git merge hotfix_automations
```

</div>

</div>

> **<span colorid="ejb8w1jlet">Critical Notes: </span>**
>
> - If you have merge conflicts here, it would mean that your hotfixes conflict with approved changes deployed in TEST ( this is a head on main branch) . Becuase hotfixes are usually done very fast it’s very unlikely that another developer would manage to merge into main while you are working on the hotfix, however, if it happens the merge should be abotred by `git merge --abort` and/or if needed do `git rebase`
>
> - **Another very likely threat is losing the latest chages.** For example, if you hotfix a package in Prod, you can ealisy lose five new procedures addded to the package. **This is a reason that why** every hotfix should ideally go via PR process and peer review!

# 9. Deploy to DEV

> **Note:** For small changes, you can replace this step by manually running scripts with chnages in DEV and TEST. However, it may introduce consistency problems later one. So, please use it with a lot of caution, and only for the smallest chnages and when you are sure that would be no merge conflicts!

After a successful merge into main, we can run a deployment to DEV.

- As a precaution, check/verify what changsets would be deployed by running

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="109f96f5-8667-4975-a516-58b4a9a164ab" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
  !git switch main
  conn -name proj_dev
  lb status  -changelog-file releases/main.changelog.xml
 
```

</div>

</div>

- If results are as expected, proceed with the deployment

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="4c9a6104-3d80-4b4e-b6bc-a092cff86ebf" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
 cd dist --- if needed
 @install
```

</div>

</div>

# 10. Deploy to Test

> **Note:** For small changes, you can replace this step by manually running scripts with chnages in DEV and TEST. However, it may introduce consistency problems later one. So, please use it with a lot of caution, and only for the smallest chnages and when you are sure that would be no merge conflicts!

The final step is deploying to Test. It’s critical to closely watch that there are no (new ) compilation errors.

<div class="code panel pdl conf-macro output-block" hasbody="true" macro-id="29644337-1ddd-404f-bf1d-8e7ba71c9a7c" macro-name="code" style="border-width: 1px;">

<div class="codeContent panelContent pdl">

``` sql
conn -name proj_test
cd dist
lb status  -changelog-file releases/main.changelog.xml
@install
```

</div>

</div>
